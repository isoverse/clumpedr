<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using clumpedr: basic data analysis • clumpedr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using clumpedr: basic data analysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">clumpedr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clumped.html">Using clumpedr: basic data analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/isoverse/clumpedr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using clumpedr: basic data analysis</h1>
                        <h4 data-toc-skip class="author">Ilja J.
Kocken</h4>
            
            <h4 data-toc-skip class="date">2024-05-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/isoverse/clumpedr/blob/master/vignettes/clumped.Rmd" class="external-link"><code>vignettes/clumped.Rmd</code></a></small>
      <div class="hidden name"><code>clumped.Rmd</code></div>

    </div>

    
    
<p>Once you have <code>clumpedr</code> installed (see the README), you
can first load the libraries:</p>
<div class="section level2">
<h2 id="load-the-packages-that-we-use">load the packages that we use<a class="anchor" aria-label="anchor" href="#load-the-packages-that-we-use"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># library(tidyverse)  # a few of the below and many more</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span>      <span class="co"># optional, if you want to glue strings together</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>     <span class="co"># for pipes, mutate, summarise, etc.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>     <span class="co"># for nesting/unnesting</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>   <span class="co"># for plots!</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://isoreader.isoverse.org" class="external-link">isoreader</a></span><span class="op">)</span> <span class="co"># read in raw data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'isoreader'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://clumpedr.isoverse.org/" class="external-link">clumpedr</a></span><span class="op">)</span>  <span class="co"># this package! process clumped isotope data</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-your-data-from-raw-instrument-data-into-r">get your data from raw instrument data into R<a class="anchor" aria-label="anchor" href="#get-your-data-from-raw-instrument-data-into-r"></a>
</h2>
<div class="section level3">
<h3 id="load-data-from-a-remote">load data from a remote<a class="anchor" aria-label="anchor" href="#load-data-from-a-remote"></a>
</h3>
<p>First locate where you have your raw data files stored.</p>
<p>Here I show how I load data from a remote Windows samba server on my
GNU/Linux machine.</p>
<p>Of course you can also just copy your files and paste them in a
folder you desire.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">folderstr</span> <span class="op">&lt;-</span> <span class="st">"/run/user/1000/gvfs/smb-share:server=geofile02.geo.uu.nl,share=geo-labs/@RawData"</span></span>
<span><span class="co"># read all did files</span></span>
<span><span class="va">dids</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_read_dual_inlet.html" class="external-link">iso_read_dual_inlet</a></span><span class="op">(</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{folderstr}/253pluskiel/Raw Data/Kiel Raw Data"</span><span class="op">)</span>,</span>
<span>                            cache <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            discard_duplicates <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>It is nice to save a cache/backup as an R data structure file, which
we can read in much faster.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_save.html" class="external-link">iso_save</a></span><span class="op">(</span><span class="va">dids</span>, <span class="st">"out/dids.di.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-from-the-cache">load from the cache<a class="anchor" aria-label="anchor" href="#load-from-the-cache"></a>
</h3>
<p>Once we have saved the r data storage (<code>.rds</code>) file, we
can load it much faster than the raw data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dids</span>  <span class="op">&lt;-</span> <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_read_dual_inlet.html" class="external-link">iso_read_dual_inlet</a></span><span class="op">(</span><span class="st">"out/dids.di.rds"</span><span class="op">)</span></span></code></pre></div>
<p>I have made some standard data available here so as to run the tests,
or a single did file for an ETH-3 standard.</p>
<p>See their documentation with the following code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">standards</span></span>
<span><span class="op">?</span><span class="va">eth3</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="process-the-data">process the data!<a class="anchor" aria-label="anchor" href="#process-the-data"></a>
</h2>
<p>We save the file info separately, since we will have to refer to it
for some plots.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stdinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_get_file_info.html" class="external-link">iso_get_file_info</a></span><span class="op">(</span><span class="va">standards</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: aggregating file info from 27 data file(s)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">stdinfo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 27</span></span>
<span><span class="co">#&gt; Columns: 21</span></span>
<span><span class="co">#&gt; $ file_id               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "180814_75_IAM_1_ETH-3.did", "180814_75_IAM_10_I…</span></span>
<span><span class="co">#&gt; $ file_root             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/home/japhir/Documents/archive/motu/dids/_18081…</span></span>
<span><span class="co">#&gt; $ file_path             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "180814_75_IAM_1_ETH-3.did", "180814_75_IAM_10_I…</span></span>
<span><span class="co">#&gt; $ file_subpath          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ file_datetime         <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2018-08-14 15:08:12, 2018-08-14 20:43:58, 2018-…</span></span>
<span><span class="co">#&gt; $ file_size             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 758773, 758965, 758927, 758639, 758899, 758899, …</span></span>
<span><span class="co">#&gt; $ Row                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "10", "11", "2", "3", "4", "5", "6", "7", "…</span></span>
<span><span class="co">#&gt; $ `Peak Center`         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"…</span></span>
<span><span class="co">#&gt; $ Background            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"…</span></span>
<span><span class="co">#&gt; $ Pressadjust           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"…</span></span>
<span><span class="co">#&gt; $ `Reference Refill`    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "0", "1", "0", "0", "0", "0", "1", "0", "0"…</span></span>
<span><span class="co">#&gt; $ Line                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "2", "1", "2", "1", "2", "1", "2", "1", "2"…</span></span>
<span><span class="co">#&gt; $ Sample                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2", "6", "7", "2", "3", "3", "4", "4", "5", "5"…</span></span>
<span><span class="co">#&gt; $ `Weight [mg]`         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "72", "84", "90", "100", "72", "86", "76", "85",…</span></span>
<span><span class="co">#&gt; $ `Identifier 1`        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "ETH-3", "IAEA-C2", "IAEA-C1", "ETH-3", "ETH-1",…</span></span>
<span><span class="co">#&gt; $ Analysis              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4841", "4850", "4851", "4842", "4843", "4844", …</span></span>
<span><span class="co">#&gt; $ Comment               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "STD", "IAM", "IAM", "STD", "STD", "STD", "STD",…</span></span>
<span><span class="co">#&gt; $ Preparation           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "75", "75", "75", "75", "75", "75", "75", "75", …</span></span>
<span><span class="co">#&gt; $ Method                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Clumped LIDI Kiel.met", "Clumped LIDI Kiel.met"…</span></span>
<span><span class="co">#&gt; $ measurement_info      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;"Acid: 69.7 [°C]", "LeakRate [µBar/Min]:  132 …</span></span>
<span><span class="co">#&gt; $ MS_integration_time.s <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, …</span></span></code></pre></div>
<p>This would also be the place to add potential fixes to typos in the
file info using <code><a href="http://isoreader.isoverse.org/reference/iso_mutate_file_info.html" class="external-link">isoreader::iso_mutate_file_info()</a></code>.</p>
<div class="section level3">
<h3 id="run-the-processing-step-by-step">run the processing step-by-step<a class="anchor" aria-label="anchor" href="#run-the-processing-step-by-step"></a>
</h3>
<p>Note that normally, it is faster and smarter not to save the output
of every step as a separate tibble, but in this case we do it so that we
can easily inspect the results along the way. See the end of the
vignette for the single pipeline.</p>
<div class="section level4">
<h4 id="filter-measurements-of-interest">filter measurements of interest<a class="anchor" aria-label="anchor" href="#filter-measurements-of-interest"></a>
</h4>
<p>First we filter out the measurements we want, based on the Method
name.</p>
<p>We use a regular expression, or <code>regexp</code>. They are very
useful ways of looking for patterns in strings.</p>
<p>Note that I put the name of the newly generated object at the end
here for this and future code chunks, so we <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> the
result for inspection.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filt</span> <span class="op">&lt;-</span> <span class="va">standards</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we can subset to some files of interest (e.g., based on a regular expression)</span></span>
<span>  <span class="co"># in this case we subset to all the runs that have a "Clumped" method.</span></span>
<span>  <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_filter_files.html" class="external-link">iso_filter_files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Clumped.*met"</span>, <span class="va">Method</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: applying file filter, keeping 27 of 27 files</span></span>
<span><span class="va">filt</span></span>
<span><span class="co">#&gt; Data from 27 dual inlet iso files: </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 6</span></span></span>
<span><span class="co">#&gt;    file_id                file_path_ file_subpath raw_data file_info method_info</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_10_IAEA… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_11_IAEA… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_2_ETH-3… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_3_ETH-1… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_4_ETH-1… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_5_ETH-2… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_6_ETH-2… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_7_ETH-4… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_8_ETH-4… 180814_75… <span style="color: #BB0000;">NA</span>           40 cycl… 21 entri… standards,…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-raw-data">extract raw data<a class="anchor" aria-label="anchor" href="#extract-raw-data"></a>
</h4>
<p>Then we extract the raw data. This gives it in a format where each
row is one cycle of either <code>standard</code> or <code>sample</code>
gas, with initensities 44–49 as columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rawd</span> <span class="op">&lt;-</span> <span class="va">filt</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># get all the raw data, per cycle from the dids</span></span>
<span>  <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_get_raw_data.html" class="external-link">iso_get_raw_data</a></span><span class="op">(</span>include_file_info <span class="op">=</span> <span class="st">"Analysis"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: aggregating raw data from 27 data file(s), including file info '"Analysis"'</span></span>
<span><span class="va">rawd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,187 × 11</span></span></span>
<span><span class="co">#&gt;    file_id Analysis type  cycle v44.mV v45.mV v46.mV v47.mV v48.mV v49.mV v54.mV</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814… 4841     stan…     0 <span style="text-decoration: underline;">16</span>647. <span style="text-decoration: underline;">19</span>675. <span style="text-decoration: underline;">23</span>072. <span style="text-decoration: underline;">25</span>664.  <span style="text-decoration: underline;">2</span>124.  -<span style="color: #BB0000;">268.</span>  -<span style="color: #BB0000;">270.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814… 4841     stan…     1 <span style="text-decoration: underline;">16</span>406. <span style="text-decoration: underline;">19</span>391. <span style="text-decoration: underline;">22</span>738. <span style="text-decoration: underline;">25</span>293.  <span style="text-decoration: underline;">2</span>094.  -<span style="color: #BB0000;">264.</span>  -<span style="color: #BB0000;">265.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814… 4841     stan…     2 <span style="text-decoration: underline;">16</span>153. <span style="text-decoration: underline;">19</span>091. <span style="text-decoration: underline;">22</span>387. <span style="text-decoration: underline;">24</span>899.  <span style="text-decoration: underline;">2</span>062.  -<span style="color: #BB0000;">259.</span>  -<span style="color: #BB0000;">261.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814… 4841     stan…     3 <span style="text-decoration: underline;">15</span>891. <span style="text-decoration: underline;">18</span>782. <span style="text-decoration: underline;">22</span>024. <span style="text-decoration: underline;">24</span>502.  <span style="text-decoration: underline;">2</span>029.  -<span style="color: #BB0000;">255.</span>  -<span style="color: #BB0000;">257.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814… 4841     stan…     4 <span style="text-decoration: underline;">15</span>631. <span style="text-decoration: underline;">18</span>476. <span style="text-decoration: underline;">21</span>665. <span style="text-decoration: underline;">24</span>100.  <span style="text-decoration: underline;">1</span>997.  -<span style="color: #BB0000;">250.</span>  -<span style="color: #BB0000;">252.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814… 4841     stan…     5 <span style="text-decoration: underline;">15</span>383. <span style="text-decoration: underline;">18</span>182. <span style="text-decoration: underline;">21</span>321. <span style="text-decoration: underline;">23</span>717.  <span style="text-decoration: underline;">1</span>964.  -<span style="color: #BB0000;">246.</span>  -<span style="color: #BB0000;">249.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814… 4841     stan…     6 <span style="text-decoration: underline;">15</span>135. <span style="text-decoration: underline;">17</span>889. <span style="text-decoration: underline;">20</span>978. <span style="text-decoration: underline;">23</span>336.  <span style="text-decoration: underline;">1</span>934.  -<span style="color: #BB0000;">241.</span>  -<span style="color: #BB0000;">244.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814… 4841     stan…     7 <span style="text-decoration: underline;">14</span>892. <span style="text-decoration: underline;">17</span>603. <span style="text-decoration: underline;">20</span>641. <span style="text-decoration: underline;">22</span>959.  <span style="text-decoration: underline;">1</span>903.  -<span style="color: #BB0000;">237.</span>  -<span style="color: #BB0000;">240.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814… 4841     stan…     8 <span style="text-decoration: underline;">14</span>656. <span style="text-decoration: underline;">17</span>323. <span style="text-decoration: underline;">20</span>313. <span style="text-decoration: underline;">22</span>600.  <span style="text-decoration: underline;">1</span>873.  -<span style="color: #BB0000;">234.</span>  -<span style="color: #BB0000;">236.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814… 4841     stan…     9 <span style="text-decoration: underline;">14</span>422. <span style="text-decoration: underline;">17</span>047. <span style="text-decoration: underline;">19</span>990. <span style="text-decoration: underline;">22</span>234.  <span style="text-decoration: underline;">1</span>844.  -<span style="color: #BB0000;">229.</span>  -<span style="color: #BB0000;">232.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,177 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="disable-failed-cycles">disable failed cycles<a class="anchor" aria-label="anchor" href="#disable-failed-cycles"></a>
</h4>
<p>This disables any cycles that have a sudden drop in
pressure/intensity.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">disc</span> <span class="op">&lt;-</span> <span class="va">rawd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dis_min <span class="op">=</span> <span class="fl">500</span>, dis_max <span class="op">=</span> <span class="fl">50000</span>, dis_fac <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_bad_cycles.html">find_bad_cycles</a></span><span class="op">(</span>min <span class="op">=</span> <span class="st">"dis_min"</span>, max <span class="op">=</span> <span class="st">"dis_max"</span>,</span>
<span>                  fac <span class="op">=</span> <span class="st">"dis_fac"</span>, relative_to <span class="op">=</span> <span class="st">"init"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: found 0 out of 27 acquisitions with a drop in pressure of mass 44.</span></span>
<span><span class="va">disc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">outlier_cycle_low</span><span class="op">:</span><span class="va">outlier_cycle</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,187 × 10</span></span></span>
<span><span class="co">#&gt;    file_id        outlier_cycle_low outlier_cycle_high cycle_diff first_diff_fac</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">241.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">254.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">262.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">259.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">249.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">248.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">243.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">237.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">234.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM… FALSE             FALSE                   -<span style="color: #BB0000;">226.</span>          -<span style="color: #BB0000;">723.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,177 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: cycle_drop &lt;lgl&gt;, cycle_has_drop &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cycle_drop_num &lt;int&gt;, outlier_cycle_drop &lt;lgl&gt;, outlier_cycle &lt;lgl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="find-initial-intensities-of-each-cycle">find initial intensities of each cycle<a class="anchor" aria-label="anchor" href="#find-initial-intensities-of-each-cycle"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_inits.html">get_inits</a></span><span class="op">(</span><span class="va">rawd</span><span class="op">)</span></span>
<span><span class="va">inits</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 4</span></span></span>
<span><span class="co">#&gt;    file_id                      Analysis s44_init r44_init</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.did    4841       <span style="text-decoration: underline;">16</span>368.   <span style="text-decoration: underline;">16</span>647.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_10_IAEA-C2.did 4850       <span style="text-decoration: underline;">17</span>072.   <span style="text-decoration: underline;">17</span>463.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_11_IAEA-C1.did 4851       <span style="text-decoration: underline;">18</span>887.   <span style="text-decoration: underline;">19</span>526.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_2_ETH-3.did    4842       <span style="text-decoration: underline;">23</span>711.   <span style="text-decoration: underline;">24</span>487.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_3_ETH-1.did    4843       <span style="text-decoration: underline;">13</span>337.   <span style="text-decoration: underline;">13</span>713.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_4_ETH-1.did    4844       <span style="text-decoration: underline;">17</span>347.   <span style="text-decoration: underline;">17</span>681.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_5_ETH-2.did    4845       <span style="text-decoration: underline;">17</span>347.   <span style="text-decoration: underline;">17</span>726.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_6_ETH-2.did    4846       <span style="text-decoration: underline;">19</span>338.   <span style="text-decoration: underline;">19</span>731.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_7_ETH-4.did    4847       <span style="text-decoration: underline;">16</span>709.   <span style="text-decoration: underline;">17</span>037.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_8_ETH-4.did    4848       <span style="text-decoration: underline;">16</span>031.   <span style="text-decoration: underline;">16</span>123.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="background-correction">background correction<a class="anchor" aria-label="anchor" href="#background-correction"></a>
</h4>
<p>Do a very simple background correction based on the half-cup mass
54.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgds</span> <span class="op">&lt;-</span> <span class="va">disc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/correct_backgrounds.html">correct_backgrounds</a></span><span class="op">(</span>factor <span class="op">=</span> <span class="fl">0.82</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: adding background based on half-mass with factor 0.82</span></span>
<span><span class="va">bgds</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">v47.mV</span>, <span class="va">v54.mV</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,187 × 3</span></span></span>
<span><span class="co">#&gt;    file_id                   v47.mV v54.mV</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">25</span>886.  -<span style="color: #BB0000;">270.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">25</span>510.  -<span style="color: #BB0000;">265.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">25</span>113.  -<span style="color: #BB0000;">261.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">24</span>713.  -<span style="color: #BB0000;">257.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">24</span>307.  -<span style="color: #BB0000;">252.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">23</span>921.  -<span style="color: #BB0000;">249.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">23</span>537.  -<span style="color: #BB0000;">244.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">23</span>156.  -<span style="color: #BB0000;">240.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">22</span>794.  -<span style="color: #BB0000;">236.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_1_ETH-3.did <span style="text-decoration: underline;">22</span>425.  -<span style="color: #BB0000;">232.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,177 more rows</span></span></span></code></pre></div>
<p>This overwrites the <code>v47.mV</code> column by subtracting
<code>factor</code> * the <code>v54.mV</code> column from
<code>v47.mV</code>.</p>
<p>For a background correction based on background scans performed
before each run we have to get the raw scan data into R.</p>
<p>We can do this with:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">scns</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_read_scan.html" class="external-link">iso_read_scan</a></span><span class="op">(</span><span class="st">"scan_file.scn"</span>, cache <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Processing the background scan files in this way is beyond the scope
of this vignette for now, since the functions that do the work are not
generalized enough to work for other set-ups.</p>
<p>See our <a href="https://github.com/UtrechtUniversity/clumped-processing" class="external-link">clumped-processing</a>
scripts for how we do background corrections and implement the full
clumped isotope workflow at Utrecht University.</p>
</div>
<div class="section level4">
<h4 id="spread-match">spread match<a class="anchor" aria-label="anchor" href="#spread-match"></a>
</h4>
<p>First we re-order the data into a wide format, where sample and
reference gas intensities are listed next to each other as separate
columns using the gather-unite-spread approach.</p>
<p>Then we compare reference gas to sample gas. With the
<code>method="normal"</code>, this would calculate the average of first
and second cycles for the reference gas. We can also use a
work-in-progress linear interpolation (<code>method="linterp"</code>) to
match the mass 44 intensity of the reference gas to that of the sample
gas and apply this same shift to all the other masses. At present, it
performs more poorly than the regular calculation though, probably due
to cycle elimination.</p>
<p>For example, we convert from the below:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="18%">
<col width="9%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th><code>file_id</code></th>
<th>type</th>
<th>cycle</th>
<th>v44.mV</th>
<th>v45.mV</th>
<th>v46.mV</th>
<th>v47.mV</th>
<th>v54.mV</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"file_1.did"</code></td>
<td><code>"sample"</code></td>
<td>1</td>
<td>1200</td>
<td>1100</td>
<td>1000</td>
<td>5000</td>
<td>-302</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td><code>"file_1.did"</code></td>
<td><code>"standard"</code></td>
<td>0</td>
<td>1300</td>
<td>1100</td>
<td>1000</td>
<td>5000</td>
<td>-260</td>
</tr>
<tr class="even">
<td><code>"file_1.did"</code></td>
<td><code>"standard"</code></td>
<td>1</td>
<td>1200</td>
<td>1120</td>
<td>1020</td>
<td>5020</td>
<td>-230</td>
</tr>
</tbody>
</table>
<p>to the following output:</p>
<table class="table">
<colgroup>
<col width="15%">
<col width="20%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th><code>file_id</code></th>
<th><code>file_datetime</code></th>
<th>cycle</th>
<th>s44</th>
<th>s45</th>
<th>s46</th>
<th>s47</th>
<th>s54</th>
<th>r44</th>
<th>r45</th>
<th>r46</th>
<th>r47</th>
<th>r54</th>
</tr></thead>
<tbody><tr class="odd">
<td><code>"file_1.did"</code></td>
<td>2019-03-01 12:00:00</td>
<td>1</td>
<td>1200</td>
<td>1100</td>
<td>1000</td>
<td>5000</td>
<td>-302</td>
<td>1250</td>
<td>1110</td>
<td>1010</td>
<td>5010</td>
<td>-245</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sprd</span> <span class="op">&lt;-</span> <span class="va">bgds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/spread_match.html">spread_match</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: reshaping data into wide format.</span></span>
<span><span class="co">#&gt; Info: matching working gas intensities to sample gas, using method normal</span></span>
<span><span class="va">sprd</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">r44</span><span class="op">:</span><span class="va">s49</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 14</span></span></span>
<span><span class="co">#&gt;    file_id       r44    r45    r46    r47   r48   r49   r54    s44    s45    s46</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75… <span style="text-decoration: underline;">16</span>527. <span style="text-decoration: underline;">19</span>533. <span style="text-decoration: underline;">22</span>905. <span style="text-decoration: underline;">25</span>698. <span style="text-decoration: underline;">2</span>109. -<span style="color: #BB0000;">266.</span> -<span style="color: #BB0000;">268.</span> <span style="text-decoration: underline;">16</span>368. <span style="text-decoration: underline;">19</span>438. <span style="text-decoration: underline;">22</span>942.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75… <span style="text-decoration: underline;">16</span>280. <span style="text-decoration: underline;">19</span>241. <span style="text-decoration: underline;">22</span>562. <span style="text-decoration: underline;">25</span>312. <span style="text-decoration: underline;">2</span>078. -<span style="color: #BB0000;">261.</span> -<span style="color: #BB0000;">263.</span> <span style="text-decoration: underline;">16</span>087. <span style="text-decoration: underline;">19</span>104. <span style="text-decoration: underline;">22</span>548.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75… <span style="text-decoration: underline;">16</span>022. <span style="text-decoration: underline;">18</span>937. <span style="text-decoration: underline;">22</span>205. <span style="text-decoration: underline;">24</span>913. <span style="text-decoration: underline;">2</span>046. -<span style="color: #BB0000;">257.</span> -<span style="color: #BB0000;">259.</span> <span style="text-decoration: underline;">15</span>811. <span style="text-decoration: underline;">18</span>777. <span style="text-decoration: underline;">22</span>162.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75… <span style="text-decoration: underline;">15</span>761. <span style="text-decoration: underline;">18</span>629. <span style="text-decoration: underline;">21</span>844. <span style="text-decoration: underline;">24</span>510. <span style="text-decoration: underline;">2</span>013. -<span style="color: #BB0000;">252.</span> -<span style="color: #BB0000;">255.</span> <span style="text-decoration: underline;">15</span>540. <span style="text-decoration: underline;">18</span>455. <span style="text-decoration: underline;">21</span>783.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75… <span style="text-decoration: underline;">15</span>507. <span style="text-decoration: underline;">18</span>329. <span style="text-decoration: underline;">21</span>493. <span style="text-decoration: underline;">24</span>114. <span style="text-decoration: underline;">1</span>980. -<span style="color: #BB0000;">248.</span> -<span style="color: #BB0000;">250.</span> <span style="text-decoration: underline;">15</span>275. <span style="text-decoration: underline;">18</span>141. <span style="text-decoration: underline;">21</span>411.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75… <span style="text-decoration: underline;">15</span>259. <span style="text-decoration: underline;">18</span>036. <span style="text-decoration: underline;">21</span>149. <span style="text-decoration: underline;">23</span>729. <span style="text-decoration: underline;">1</span>949. -<span style="color: #BB0000;">244.</span> -<span style="color: #BB0000;">246.</span> <span style="text-decoration: underline;">15</span>016. <span style="text-decoration: underline;">17</span>833. <span style="text-decoration: underline;">21</span>049.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75… <span style="text-decoration: underline;">15</span>014. <span style="text-decoration: underline;">17</span>746. <span style="text-decoration: underline;">20</span>810. <span style="text-decoration: underline;">23</span>346. <span style="text-decoration: underline;">1</span>918. -<span style="color: #BB0000;">239.</span> -<span style="color: #BB0000;">242.</span> <span style="text-decoration: underline;">14</span>762. <span style="text-decoration: underline;">17</span>531. <span style="text-decoration: underline;">20</span>693.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75… <span style="text-decoration: underline;">14</span>774. <span style="text-decoration: underline;">17</span>463. <span style="text-decoration: underline;">20</span>477. <span style="text-decoration: underline;">22</span>975. <span style="text-decoration: underline;">1</span>888. -<span style="color: #BB0000;">236.</span> -<span style="color: #BB0000;">238.</span> <span style="text-decoration: underline;">14</span>513. <span style="text-decoration: underline;">17</span>236. <span style="text-decoration: underline;">20</span>344.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75… <span style="text-decoration: underline;">14</span>539. <span style="text-decoration: underline;">17</span>185. <span style="text-decoration: underline;">20</span>152. <span style="text-decoration: underline;">22</span>609. <span style="text-decoration: underline;">1</span>858. -<span style="color: #BB0000;">232.</span> -<span style="color: #BB0000;">234.</span> <span style="text-decoration: underline;">14</span>269. <span style="text-decoration: underline;">16</span>946. <span style="text-decoration: underline;">20</span>001.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75… <span style="text-decoration: underline;">14</span>309. <span style="text-decoration: underline;">16</span>913. <span style="text-decoration: underline;">19</span>833. <span style="text-decoration: underline;">22</span>250. <span style="text-decoration: underline;">1</span>829. -<span style="color: #BB0000;">228.</span> -<span style="color: #BB0000;">230.</span> <span style="text-decoration: underline;">14</span>030. <span style="text-decoration: underline;">16</span>662. <span style="text-decoration: underline;">19</span>667.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: s47 &lt;dbl&gt;, s48 &lt;dbl&gt;, s49 &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-reference-gas-d13c-and-d18o-values">extract reference gas d13C and d18O values<a class="anchor" aria-label="anchor" href="#extract-reference-gas-d13c-and-d18o-values"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">refd</span> <span class="op">&lt;-</span> <span class="va">sprd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/append_ref_deltas.html">append_ref_deltas</a></span><span class="op">(</span><span class="va">standards</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: collapsing cycles, calculating sample summaries.</span></span>
<span><span class="co">#&gt; Info: appending reference gas δ values from 27 data file(s)</span></span>
<span><span class="va">refd</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">d13C_PDB_wg</span><span class="op">:</span><span class="va">d18O_PDBCO2_wg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 3</span></span></span>
<span><span class="co">#&gt;    file_id                   d13C_PDB_wg d18O_PDBCO2_wg</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">2.82</span>          -<span style="color: #BB0000;">4.67</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-little-deltas-and-clumped-values">calculate little delta’s and clumped values<a class="anchor" aria-label="anchor" href="#calculate-little-deltas-and-clumped-values"></a>
</h4>
<p>Now we can go to the bread and butter of clumpedr, delta
calculations!</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abd</span> <span class="op">&lt;-</span> <span class="va">refd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/abundance_ratios.html">abundance_ratios</a></span><span class="op">(</span>i44 <span class="op">=</span> <span class="va">s44</span>, i45 <span class="op">=</span> <span class="va">s45</span>, i46 <span class="op">=</span> <span class="va">s46</span>, i47 <span class="op">=</span> <span class="va">s47</span>, i48 <span class="op">=</span> <span class="va">s48</span>, i49 <span class="op">=</span> <span class="va">s49</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/abundance_ratios.html">abundance_ratios</a></span><span class="op">(</span>i44 <span class="op">=</span> <span class="va">r44</span>, i45 <span class="op">=</span> <span class="va">r45</span>, i46 <span class="op">=</span> <span class="va">r46</span>, i47 <span class="op">=</span> <span class="va">r47</span>, i48 <span class="op">=</span> <span class="va">r48</span>, i49 <span class="op">=</span> <span class="va">r49</span>,</span>
<span>                   R45 <span class="op">=</span> <span class="va">R45_wg</span>, R46 <span class="op">=</span> <span class="va">R46_wg</span>, R47 <span class="op">=</span> <span class="va">R47_wg</span>, R48 <span class="op">=</span> <span class="va">R48_wg</span>, R49 <span class="op">=</span> <span class="va">R49_wg</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: calculating abundance ratios R[i] = i / 44</span></span>
<span><span class="co">#&gt; Info: calculating abundance ratios R[i] = i / 44</span></span>
<span><span class="va">abd</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">R45</span><span class="op">:</span><span class="va">R49_wg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 11</span></span></span>
<span><span class="co">#&gt;    file_id     R45   R46   R47   R48     R49 R45_wg R46_wg R47_wg R48_wg  R49_wg</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span>   1.18   1.39   1.55  0.128 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span>   1.18   1.39   1.55  0.128 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span>   1.18   1.39   1.55  0.128 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span>   1.18   1.39   1.56  0.128 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">1</span>   1.18   1.39   1.56  0.128 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span>   1.18   1.39   1.56  0.128 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span>   1.18   1.39   1.55  0.128 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span>   1.18   1.39   1.56  0.128 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">9</span>   1.18   1.39   1.56  0.128 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_7…  1.19  1.40  1.58 0.131 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span>   1.18   1.39   1.55  0.128 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dlts</span> <span class="op">&lt;-</span> <span class="va">abd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/little_deltas.html">little_deltas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: calculating δ values with (Ri / Ri_wg - 1) * 1000</span></span>
<span><span class="co"># this contains some more columns, but just showing the ones of interest for now</span></span>
<span><span class="va">dlts</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">d45</span><span class="op">:</span><span class="va">d49</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 6</span></span></span>
<span><span class="co">#&gt;    file_id                     d45   d46   d47   d48   d49</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.did  4.77  11.3  15.8  23.9  1.75</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.7  23.9  4.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_1_ETH-3.did  4.75  11.3  15.7  24.0  3.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_1_ETH-3.did  4.75  11.3  15.6  23.2  5.34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.6  25.0  4.63</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.7  24.6  2.54</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.6  23.7  2.19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.7  24.0  2.97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.5  24.1  1.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_1_ETH-3.did  4.76  11.3  15.9  24.9  2.53</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bigD</span> <span class="op">&lt;-</span> <span class="va">dlts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Mineralogy <span class="op">=</span> <span class="st">"Calcite"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/bulk_and_clumping_deltas.html">bulk_and_clumping_deltas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: calculating δ¹³C, δ¹⁸O, and Δ's.</span></span>
<span>  <span class="co"># outlier on the cycle level now contains all the reasons for cycle outliers</span></span>
<span><span class="co"># it calculates more columns, but we show some of the new ones here:</span></span>
<span><span class="va">bigD</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">R13_wg</span><span class="op">:</span><span class="va">R17</span>, <span class="va">C12</span>, <span class="va">C626</span>, <span class="va">C628</span>, <span class="va">C828</span>, <span class="co"># some columns not shown here</span></span>
<span>               <span class="va">d18O_PDB</span>, <span class="va">d13C_PDB</span>, <span class="va">R47_stoch</span>, <span class="va">D47_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 12</span></span></span>
<span><span class="co">#&gt;    file_id  R13_wg  R18_wg     R17   C12  C626    C628    C828 d18O_PDB d13C_PDB</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.12</span>     1.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.12</span>     1.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.13</span>     1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.13</span>     1.83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.14</span>     1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.13</span>     1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.11</span>     1.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.10</span>     1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.10</span>     1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_… 0.011<span style="text-decoration: underline;">1</span> 0.002<span style="text-decoration: underline;">08</span> 3.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 0.989 0.984 0.004<span style="text-decoration: underline;">14</span> 4.35<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>    -<span style="color: #BB0000;">2.12</span>     1.84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: R47_stoch &lt;dbl&gt;, D47_raw &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="collapse-cycles-calculate-averages-and-standard-deviations">collapse cycles: calculate averages and standard deviations<a class="anchor" aria-label="anchor" href="#collapse-cycles-calculate-averages-and-standard-deviations"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coll</span> <span class="op">&lt;-</span> <span class="va">bigD</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/collapse_cycles.html">collapse_cycles</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d13C_PDB</span>, <span class="va">d18O_PDB</span>, <span class="va">D47_raw</span><span class="op">)</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">Analysis</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: collapsing cycles, calculating sample summaries.</span></span>
<span><span class="co">#&gt; defaulting to mean, sd, n, sem, and 95% cl</span></span>
<span>  <span class="co"># in the future we may want to use this nicer nesting approach?</span></span>
<span>  <span class="co"># It doesn't calculate summaries yet though.</span></span>
<span>  <span class="co"># nest_cycle_data(bgs = NULL)</span></span>
<span><span class="va">coll</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">d13C_PDB_mean</span>, <span class="va">D47_raw_mean</span>, <span class="va">D47_raw_cl</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 4</span></span></span>
<span><span class="co">#&gt;    file_id                      d13C_PDB_mean D47_raw_mean D47_raw_cl</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.did             1.85      -<span style="color: #BB0000;">0.506</span>      0.031<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_10_IAEA-C2.did         -<span style="color: #BB0000;">8.35</span>       0.062<span style="text-decoration: underline;">7</span>     0.034<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_11_IAEA-C1.did          2.29      -<span style="color: #BB0000;">0.256</span>      0.029<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_2_ETH-3.did             1.87      -<span style="color: #BB0000;">0.402</span>      0.028<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_3_ETH-1.did             1.55       0.071<span style="text-decoration: underline;">7</span>     0.032<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_4_ETH-1.did             1.55       0.059<span style="text-decoration: underline;">2</span>     0.028<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_5_ETH-2.did           -<span style="color: #BB0000;">10.3</span>       -<span style="color: #BB0000;">0.321</span>      0.032<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_6_ETH-2.did           -<span style="color: #BB0000;">10.3</span>       -<span style="color: #BB0000;">0.330</span>      0.026<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_7_ETH-4.did           -<span style="color: #BB0000;">10.4</span>       -<span style="color: #BB0000;">0.185</span>      0.033<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_8_ETH-4.did           -<span style="color: #BB0000;">10.4</span>       -<span style="color: #BB0000;">0.159</span>      0.030<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="append-metadata">append metadata<a class="anchor" aria-label="anchor" href="#append-metadata"></a>
</h4>
<p>This just <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join()</a></code>s the metadata based on
<code>file_id</code>, so that we can use it for outlier removal etc.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dati</span> <span class="op">&lt;-</span> <span class="va">coll</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_info.html">add_info</a></span><span class="op">(</span><span class="va">stdinfo</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"file_root"</span>, <span class="st">"file_path"</span>, <span class="st">"file_subpath"</span>,</span>
<span>                             <span class="st">"file_datetime"</span>, <span class="st">"file_size"</span>, <span class="st">"Row"</span>,</span>
<span>                             <span class="st">"Peak Center"</span>, <span class="st">"Background"</span>, <span class="st">"Pressadjust"</span>,</span>
<span>                             <span class="st">"Reference Refill"</span>, <span class="st">"Line"</span>, <span class="st">"Sample"</span>,</span>
<span>                             <span class="st">"Weight [mg]"</span>, <span class="st">"Identifier 1"</span>, <span class="st">"Comment"</span>,</span>
<span>                             <span class="st">"Preparation"</span>, <span class="st">"Method"</span>, <span class="st">"measurement_info"</span>,</span>
<span>                             <span class="st">"MS_integration_time.s"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_info.html">add_info</a></span><span class="op">(</span><span class="va">inits</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s44_init"</span>, <span class="st">"r44_init"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: appending measurement information.</span></span>
<span><span class="co">#&gt; Info: appending measurement information.</span></span>
<span><span class="va">dati</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">file_root</span><span class="op">:</span><span class="va">r44_init</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 22</span></span></span>
<span><span class="co">#&gt;    file_id  file_root file_path file_subpath file_datetime       file_size Row  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">15:08:12</span>    <span style="text-decoration: underline;">758</span>773 1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">20:43:58</span>    <span style="text-decoration: underline;">758</span>965 10   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">21:26:15</span>    <span style="text-decoration: underline;">758</span>927 11   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">15:46:26</span>    <span style="text-decoration: underline;">758</span>639 2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">16:23:09</span>    <span style="text-decoration: underline;">758</span>899 3    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">17:00:08</span>    <span style="text-decoration: underline;">758</span>899 4    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">17:37:45</span>    <span style="text-decoration: underline;">759</span>883 5    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">18:19:02</span>    <span style="text-decoration: underline;">760</span>017 6    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">18:54:34</span>    <span style="text-decoration: underline;">759</span>943 7    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_… /home/ja… 180814_7… <span style="color: #BB0000;">NA</span>           2018-08-14 <span style="color: #949494;">19:30:26</span>    <span style="text-decoration: underline;">759</span>883 8    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more variables: `Peak Center` &lt;chr&gt;, Background &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Pressadjust &lt;chr&gt;, `Reference Refill` &lt;chr&gt;, Line &lt;chr&gt;, Sample &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Weight [mg]` &lt;chr&gt;, `Identifier 1` &lt;chr&gt;, Comment &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Preparation &lt;chr&gt;, Method &lt;chr&gt;, measurement_info &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   MS_integration_time.s &lt;dbl&gt;, s44_init &lt;dbl&gt;, r44_init &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-outliers">remove outliers<a class="anchor" aria-label="anchor" href="#remove-outliers"></a>
</h4>
<p>Based on several criteria, we can get rid of outliers. This needs to
happen before the Empirical Reference Frame is calculated and
applied.</p>
<p>Here we just filter outliers based on initial intensities.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rout</span> <span class="op">&lt;-</span> <span class="va">dati</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">cycle_data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_init_outliers.html">find_init_outliers</a></span><span class="op">(</span>init_low <span class="op">=</span> <span class="fl">4000</span>, init_high <span class="op">=</span> <span class="fl">40000</span>, init_diff <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/summarize_outlier.html">summarize_outlier</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: identifying aliquots with 4000 &gt; i44_init &amp; i44_init &lt; 40000, s44 - r44 &gt; 3000.</span></span>
<span><span class="co">#&gt; Info: creating a single `outlier` column, based on all "outlier_" columns.</span></span>
<span><span class="va">rout</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"outlier"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 17</span></span></span>
<span><span class="co">#&gt;    file_id    outlier_cycle_low_r44 outlier_cycle_low_s44 outlier_cycle_high_r44</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75… FALSE                 FALSE                 FALSE                 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more variables: outlier_cycle_high_s44 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_cycle_drop_r44 &lt;lgl&gt;, outlier_cycle_drop_s44 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_cycle_r44 &lt;lgl&gt;, outlier_cycle_s44 &lt;lgl&gt;, outlier_cycle &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_s44_init_low &lt;lgl&gt;, outlier_r44_init_low &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_s44_init_high &lt;lgl&gt;, outlier_r44_init_high &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_i44_init_diff &lt;lgl&gt;, outlier_init &lt;lgl&gt;, outlier &lt;lgl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="empirical-transfer-function">empirical transfer function<a class="anchor" aria-label="anchor" href="#empirical-transfer-function"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">detf</span> <span class="op">&lt;-</span> <span class="va">rout</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/append_expected_values.html">append_expected_values</a></span><span class="op">(</span>std_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ETH-1"</span>, <span class="st">"ETH-2"</span>, <span class="st">"ETH-3"</span><span class="op">)</span>,</span>
<span>                         <span class="co"># I-CDES values (make sure to double-check which ones you use!)</span></span>
<span>                         std_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2052</span>, <span class="fl">0.2085</span>, <span class="fl">0.6132</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calculate_etf.html">calculate_etf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/apply_etf.html">apply_etf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: Applying ETF to D47_raw using α = slope and β = intercept.</span></span>
<span><span class="co">#&gt; Info: Calculating ETF with D47_raw_mean as a function of expected_D47 for each Preparation.</span></span>
<span><span class="co">#&gt; Info: Appending expected values as expected_D47 for standards ETH-1 ETH-2 and ETH-3</span></span>
<span>  <span class="co">## or the three functions above combined into one function</span></span>
<span>  <span class="co">## empirical_transfer_function()</span></span>
<span><span class="va">detf</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">expected_D47</span><span class="op">:</span><span class="va">D47_etf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 7</span></span></span>
<span><span class="co">#&gt;    file_id                 expected_D47 etf   etf_coefs intercept slope  D47_etf</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497  0.158  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">83</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.028</span><span style="color: #BB0000; text-decoration: underline;">8</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.214</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.186</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.058</span><span style="color: #BB0000; text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.179</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497 -<span style="color: #BB0000;">0.470</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_1_ETH-3.…        0.613 <span style="color: #949494;">&lt;lm&gt;</span>  <span style="color: #949494;">&lt;dbl [2]&gt;</span>    -<span style="color: #BB0000;">0.408</span> 0.497  0.346  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="temperature-calculation">temperature calculation<a class="anchor" aria-label="anchor" href="#temperature-calculation"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">detf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">0.0397</span>, intercept <span class="op">=</span> <span class="fl">0.1518</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/temperature_calculation.html">temperature_calculation</a></span><span class="op">(</span>D47 <span class="op">=</span> <span class="va">D47_etf</span>, slope <span class="op">=</span> <span class="st">"slope"</span>, intercept <span class="op">=</span> <span class="st">"intercept"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: calculating temperature with slope 0.0397 and intercept 0.1518, ignoring uncertainty in the calibration.</span></span>
<span><span class="co">#&gt; If you would like to include temperature uncertainty using bootstrapping, see the package `clumpedcalib` on &lt;https://github.com/japhir/clumpedcalib&gt;</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `temperature = revcal(...)`.</span></span>
<span><span class="co">#&gt; Caused by warning in `sqrt()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="va">temp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">D47_raw_mean</span>, <span class="va">D47_etf</span>, <span class="va">temperature</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 4</span></span></span>
<span><span class="co">#&gt;    file_id                   D47_raw_mean  D47_etf temperature</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span>  0.158         <span style="text-decoration: underline;">2</span>181.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">83</span>        <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.028</span><span style="color: #BB0000; text-decoration: underline;">8</span>         <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.214</span>          <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.186</span>          <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.058</span><span style="color: #BB0000; text-decoration: underline;">5</span>         <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.179</span>          <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.027</span><span style="color: #BB0000; text-decoration: underline;">5</span>         <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span> -<span style="color: #BB0000;">0.470</span>          <span style="color: #BB0000;">NaN</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 180814_75_IAM_1_ETH-3.did       -<span style="color: #BB0000;">0.506</span>  0.346          179.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span></code></pre></div>
<p>Note that in the case of many small replicates, it is better to do
your analysis based on the D47 values and then convert to temperature in
the final phase of your analysis, rather than here at the aliquot
level.</p>
<p>Furthermore, error propagation of the calibration uncertainty is not
incorporated here. If you would like to include temperature uncertainty
using bootstrapping, see the package <code>clumpedcalib</code> on <a href="https://github.com/japhir/clumpedcalib" class="external-link uri">https://github.com/japhir/clumpedcalib</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="plots-and-summary">plots and summary<a class="anchor" aria-label="anchor" href="#plots-and-summary"></a>
</h3>
<p>We can create some summary plots, i.e. of the final D47 values for
each standard:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a tibble that holds heights for text annotations</span></span>
<span><span class="va">summ</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`Identifier 1`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">D47_etf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fl">.05</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`Identifier 1`</span>, y <span class="op">=</span> <span class="va">D47_etf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">`Identifier 1`</span>, fill <span class="op">=</span> <span class="va">`Identifier 1`</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">`Identifier 1`</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">.05</span>, alpha <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`Identifier 1`</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">summ</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="clumped_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<p>If you do not understand any of the steps, look at the function
documentation (e.g.: <code><a href="../reference/empirical_transfer_function.html">?empirical_transfer_function</a></code>) or look
at the source code (type the function name without parentheses into the
command line).</p>
<p>Enjoy!</p>
<p>Here are all the steps in one pipeline:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stdinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_get_file_info.html" class="external-link">iso_get_file_info</a></span><span class="op">(</span><span class="va">standards</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: aggregating file info from 27 data file(s)</span></span>
<span></span>
<span><span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_inits.html">get_inits</a></span><span class="op">(</span><span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_get_raw_data.html" class="external-link">iso_get_raw_data</a></span><span class="op">(</span><span class="va">standards</span>, include_file_info <span class="op">=</span> <span class="st">"Analysis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: aggregating raw data from 27 data file(s), including file info '"Analysis"'</span></span>
<span></span>
<span><span class="va">standards</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_filter_files.html" class="external-link">iso_filter_files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Clumped.*met"</span>, <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="http://isoreader.isoverse.org/reference/iso_get_raw_data.html" class="external-link">iso_get_raw_data</a></span><span class="op">(</span>include_file_info <span class="op">=</span> <span class="st">"Analysis"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dis_min <span class="op">=</span> <span class="fl">500</span>, dis_max <span class="op">=</span> <span class="fl">50000</span>, dis_fac <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_bad_cycles.html">find_bad_cycles</a></span><span class="op">(</span>min <span class="op">=</span> <span class="st">"dis_min"</span>, max <span class="op">=</span> <span class="st">"dis_max"</span>,</span>
<span>                  fac <span class="op">=</span> <span class="st">"dis_fac"</span>, relative_to <span class="op">=</span> <span class="st">"init"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/correct_backgrounds.html">correct_backgrounds</a></span><span class="op">(</span><span class="fl">0.82</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/spread_match.html">spread_match</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/append_ref_deltas.html">append_ref_deltas</a></span><span class="op">(</span><span class="va">standards</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/abundance_ratios.html">abundance_ratios</a></span><span class="op">(</span>i44 <span class="op">=</span> <span class="va">s44</span>, i45 <span class="op">=</span> <span class="va">s45</span>, i46 <span class="op">=</span> <span class="va">s46</span>, i47 <span class="op">=</span> <span class="va">s47</span>, i48 <span class="op">=</span> <span class="va">s48</span>, i49 <span class="op">=</span> <span class="va">s49</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/abundance_ratios.html">abundance_ratios</a></span><span class="op">(</span>i44 <span class="op">=</span> <span class="va">r44</span>, i45 <span class="op">=</span> <span class="va">r45</span>, i46 <span class="op">=</span> <span class="va">r46</span>, i47 <span class="op">=</span> <span class="va">r47</span>, i48 <span class="op">=</span> <span class="va">r48</span>, i49 <span class="op">=</span> <span class="va">r49</span>,</span>
<span>                   R45 <span class="op">=</span> <span class="va">R45_wg</span>, R46 <span class="op">=</span> <span class="va">R46_wg</span>, R47 <span class="op">=</span> <span class="va">R47_wg</span>, R48 <span class="op">=</span> <span class="va">R48_wg</span>, R49 <span class="op">=</span> <span class="va">R49_wg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/little_deltas.html">little_deltas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Mineralogy <span class="op">=</span> <span class="st">"Calcite"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/bulk_and_clumping_deltas.html">bulk_and_clumping_deltas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># outlier on the cycle level now contains all the reasons for cycle outliers</span></span>
<span>  <span class="fu"><a href="../reference/summarise_outlier.html">summarise_outlier</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/collapse_cycles.html">collapse_cycles</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d18O_PDBCO2</span>, <span class="va">d13C_PDB</span>, <span class="va">D47_raw</span><span class="op">)</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">file_id</span>, <span class="va">Analysis</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_info.html">add_info</a></span><span class="op">(</span><span class="va">stdinfo</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"file_root"</span>, <span class="st">"file_path"</span>, <span class="st">"file_subpath"</span>,</span>
<span>                             <span class="st">"file_datetime"</span>, <span class="st">"file_size"</span>, <span class="st">"Row"</span>,</span>
<span>                             <span class="st">"Peak Center"</span>, <span class="st">"Background"</span>, <span class="st">"Pressadjust"</span>,</span>
<span>                             <span class="st">"Reference Refill"</span>, <span class="st">"Line"</span>, <span class="st">"Sample"</span>,</span>
<span>                             <span class="st">"Weight [mg]"</span>, <span class="st">"Identifier 1"</span>, <span class="st">"Comment"</span>,</span>
<span>                             <span class="st">"Preparation"</span>, <span class="st">"Method"</span>, <span class="st">"measurement_info"</span>,</span>
<span>                             <span class="st">"MS_integration_time.s"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_info.html">add_info</a></span><span class="op">(</span><span class="va">inits</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s44_init"</span>, <span class="st">"r44_init"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">cycle_data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_init_outliers.html">find_init_outliers</a></span><span class="op">(</span>init_low <span class="op">=</span> <span class="fl">4000</span>, init_high <span class="op">=</span> <span class="fl">40000</span>, init_diff <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/summarize_outlier.html">summarize_outlier</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/empirical_transfer_function.html">empirical_transfer_function</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">0.0397</span>, intercept <span class="op">=</span> <span class="fl">0.1518</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/temperature_calculation.html">temperature_calculation</a></span><span class="op">(</span>D47 <span class="op">=</span> <span class="va">D47_etf</span>, slope <span class="op">=</span> <span class="st">"slope"</span>, intercept <span class="op">=</span> <span class="st">"intercept"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Info: calculating and applying Emperical Transfer Function, with D47_raw as a function of expected_D47, for each Preparation.</span></span>
<span><span class="co">#&gt; Info: collapsing cycles, calculating sample summaries.</span></span>
<span><span class="co">#&gt; defaulting to mean, sd, n, sem, and 95% cl</span></span>
<span><span class="co">#&gt; Info: adding background based on half-mass with factor 0.82</span></span>
<span><span class="co">#&gt; Info: applying file filter, keeping 27 of 27 files</span></span>
<span><span class="co">#&gt; Info: aggregating raw data from 27 data file(s), including file info '"Analysis"'</span></span>
<span><span class="co">#&gt; Info: found 0 out of 27 acquisitions with a drop in pressure of mass 44.</span></span>
<span><span class="co">#&gt; Info: reshaping data into wide format.</span></span>
<span><span class="co">#&gt; Info: matching working gas intensities to sample gas, using method normal</span></span>
<span><span class="co">#&gt; Info: collapsing cycles, calculating sample summaries.</span></span>
<span><span class="co">#&gt; Info: appending reference gas δ values from 27 data file(s)</span></span>
<span><span class="co">#&gt; Info: calculating abundance ratios R[i] = i / 44</span></span>
<span><span class="co">#&gt; Info: calculating abundance ratios R[i] = i / 44</span></span>
<span><span class="co">#&gt; Info: calculating δ values with (Ri / Ri_wg - 1) * 1000</span></span>
<span><span class="co">#&gt; Info: calculating δ¹³C, δ¹⁸O, and Δ's.</span></span>
<span><span class="co">#&gt; Info: appending measurement information.</span></span>
<span><span class="co">#&gt; Info: appending measurement information.</span></span>
<span><span class="co">#&gt; Info: identifying aliquots with 4000 &gt; i44_init &amp; i44_init &lt; 40000, s44 - r44 &gt; 3000.</span></span>
<span><span class="co">#&gt; Info: creating a single `outlier` column, based on all "outlier_" columns.</span></span>
<span><span class="co">#&gt; Info: calculating temperature with slope 0.0397 and intercept 0.1518, ignoring uncertainty in the calibration.</span></span>
<span><span class="co">#&gt; If you would like to include temperature uncertainty using bootstrapping, see the package `clumpedcalib` on &lt;https://github.com/japhir/clumpedcalib&gt;</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `temperature = revcal(...)`.</span></span>
<span><span class="co">#&gt; Caused by warning in `sqrt()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,080 × 149</span></span></span>
<span><span class="co">#&gt;    Preparation file_id    Analysis cycle    r44    r45    r46    r47   r48   r49</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 75          180814_75… 4841         1 <span style="text-decoration: underline;">16</span>527. <span style="text-decoration: underline;">19</span>533. <span style="text-decoration: underline;">22</span>905. <span style="text-decoration: underline;">25</span>698. <span style="text-decoration: underline;">2</span>109. -<span style="color: #BB0000;">266.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 75          180814_75… 4841         2 <span style="text-decoration: underline;">16</span>280. <span style="text-decoration: underline;">19</span>241. <span style="text-decoration: underline;">22</span>562. <span style="text-decoration: underline;">25</span>312. <span style="text-decoration: underline;">2</span>078. -<span style="color: #BB0000;">261.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 75          180814_75… 4841         3 <span style="text-decoration: underline;">16</span>022. <span style="text-decoration: underline;">18</span>937. <span style="text-decoration: underline;">22</span>205. <span style="text-decoration: underline;">24</span>913. <span style="text-decoration: underline;">2</span>046. -<span style="color: #BB0000;">257.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 75          180814_75… 4841         4 <span style="text-decoration: underline;">15</span>761. <span style="text-decoration: underline;">18</span>629. <span style="text-decoration: underline;">21</span>844. <span style="text-decoration: underline;">24</span>510. <span style="text-decoration: underline;">2</span>013. -<span style="color: #BB0000;">252.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 75          180814_75… 4841         5 <span style="text-decoration: underline;">15</span>507. <span style="text-decoration: underline;">18</span>329. <span style="text-decoration: underline;">21</span>493. <span style="text-decoration: underline;">24</span>114. <span style="text-decoration: underline;">1</span>980. -<span style="color: #BB0000;">248.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 75          180814_75… 4841         6 <span style="text-decoration: underline;">15</span>259. <span style="text-decoration: underline;">18</span>036. <span style="text-decoration: underline;">21</span>149. <span style="text-decoration: underline;">23</span>729. <span style="text-decoration: underline;">1</span>949. -<span style="color: #BB0000;">244.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 75          180814_75… 4841         7 <span style="text-decoration: underline;">15</span>014. <span style="text-decoration: underline;">17</span>746. <span style="text-decoration: underline;">20</span>810. <span style="text-decoration: underline;">23</span>346. <span style="text-decoration: underline;">1</span>918. -<span style="color: #BB0000;">239.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 75          180814_75… 4841         8 <span style="text-decoration: underline;">14</span>774. <span style="text-decoration: underline;">17</span>463. <span style="text-decoration: underline;">20</span>477. <span style="text-decoration: underline;">22</span>975. <span style="text-decoration: underline;">1</span>888. -<span style="color: #BB0000;">236.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 75          180814_75… 4841         9 <span style="text-decoration: underline;">14</span>539. <span style="text-decoration: underline;">17</span>185. <span style="text-decoration: underline;">20</span>152. <span style="text-decoration: underline;">22</span>609. <span style="text-decoration: underline;">1</span>858. -<span style="color: #BB0000;">232.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 75          180814_75… 4841        10 <span style="text-decoration: underline;">14</span>309. <span style="text-decoration: underline;">16</span>913. <span style="text-decoration: underline;">19</span>833. <span style="text-decoration: underline;">22</span>250. <span style="text-decoration: underline;">1</span>829. -<span style="color: #BB0000;">228.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,070 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 139 more variables: r54 &lt;dbl&gt;, s44 &lt;dbl&gt;, s45 &lt;dbl&gt;, s46 &lt;dbl&gt;, s47 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   s48 &lt;dbl&gt;, s49 &lt;dbl&gt;, s54 &lt;dbl&gt;, outlier_cycle_low_r44 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_cycle_low_s44 &lt;lgl&gt;, outlier_cycle_high_r44 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   outlier_cycle_high_s44 &lt;lgl&gt;, cycle_diff_r44 &lt;dbl&gt;, cycle_diff_s44 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cycle_drop_r44 &lt;lgl&gt;, cycle_drop_s44 &lt;lgl&gt;, cycle_drop_num_r44 &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cycle_drop_num_s44 &lt;int&gt;, outlier_cycle_drop_r44 &lt;lgl&gt;, …</span></span></span></code></pre></div>
<div class="section level4">
<h4 id="hint-look-at-plots-interactively">HINT: look at plots interactively<a class="anchor" aria-label="anchor" href="#hint-look-at-plots-interactively"></a>
</h4>
<p>Note that it is very nice to look at this plot—or any of the future
ones—interactively using <code>ggplotly</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/toWebGL.html" class="external-link">toWebGL</a></span><span class="op">(</span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span>dynamicTicks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This creates an interactive version of the last plot in your
browser.</p>
<p>You can also assign extra aesthetics that you do not directly see to
your plot, for example <code>aes(ID = file_id, no = Analysis)</code> and
this information will show up when you hover a point.</p>
<p>Note that we use the <code>toWebGL</code> wrapper to make it run
smoother for plots with many points.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ilja Kocken.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
